!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self)["enigma-mixin"]=t()}(this,function(){"use strict";var e={sessionList:{qInfo:{qId:"",qType:"SessionLists"},qSelectionObjectDef:{}},variableList:{qInfo:{qType:"VariableList"},qVariableListDef:{qType:"variable"}},listBox:{qInfo:{qId:"",qType:"Combo"},field:{qListObjectDef:{qStateName:"$",qDef:{qFieldDefs:[],qSortCriterias:[{qSortByState:1,qExpression:{}}]},qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:100,qWidth:1}]}}}};var t={mGetVariablesAll:async function({showSession:t=!1,showConfig:r=!1,showReserved:n=!1}={}){let a=e.variableList;a.qShowSession=t,a.qShowConfig=r,a.qShowReserved=n;try{let e=await this.createSessionObject(a);return(await e.getLayout()).qVariableList.qItems}catch(e){throw new Error(e.message)}},mUpdateVariable:async function(e){try{let t=await this.getVariableById(e.qInfo.qId);return await t.setProperties(e)}catch(e){throw new Error(e.message)}},mCreateVariable:async function({name:e,comment:t="",definition:r}){let n={qInfo:{qType:"variable"},qName:e,qComment:t,qDefinition:r};try{return await this.createVariableEx(n)}catch(e){throw new Error(e.message)}}};async function r(t){try{let r=await t.createSessionObject(e.sessionList);return await r.getLayout()}catch(e){throw new Error(e.message)}}var n={mGetSelectionsCurr:async function(){try{let e=await r(this),t=e.qSelectionObject.qSelections.map(function(e){return e.qField});return{selections:e.qSelectionObject.qSelections,fields:t}}catch(e){throw new Error(e.message)}},mGetSelectionsCurrNative:async function(){try{return await r(this)}catch(e){throw new Error(e.message)}},mSelectInField:async function({fieldName:e,values:t,toggle:r=!1}){try{let n=await this.getField(e),a=t.map(function(e){return{qText:e}});try{return await n.selectValues({qFieldValues:a,qToggleMode:r})}catch(e){throw new Error(e.message)}}catch(e){throw new Error(e.message)}}};var a={mGetTablesAndFields:async function(){try{let e=await this.getTablesAndKeys({},{},0,!0,!1),t=[];if(0==e.qtr.length)return t;for(let r of e.qtr)for(let e of r.qFields)t.push({table:r.qName,field:e.qName});return t}catch(e){throw new Error(e.message)}},mGetTables:async function(){try{let e=await this.getTablesAndKeys({},{},0,!0,!1),t=[];if(0==e.length)return t;for(let r of e.qtr)t.push(r.qName);return t}catch(e){throw new Error(e.message)}},mGetFields:async function(){try{let e=await this.getTablesAndKeys({},{},0,!0,!1),t=[];for(let r of e.qtr)for(let e of r.qFields)t.push(e.qName);return t}catch(e){throw new Error(e.message)}},mGetListbox:async function(t){try{let r=e.listBox;r.field.qListObjectDef.qDef.qFieldDefs.push(t);let n=await this.createSessionObject(r);return(await n.getLayout()).field.qListObject}catch(e){throw new Error(e.message)}}};const i=["barchart","bookmark","combochart","dimension","embeddedsnapshot","filterpane","gauge","kpi","linechart","listbox","LoadModel","map","masterobject","measure","piechart","pivot-table","scatterplot","sheet","slide","slideitem","snapshot","story","StringExpression","table","treemap"];const s=async function(e,t){let r=!1,n={};try{let a=await e.getObject(t);(n=await a.getProperties()).extensionMeta&&(r=!0)}catch(e){throw new Error(e.message)}return{qObjProps:n,isExtension:r}};var o={mGetAllExtensionObjects:async function(){let e=await this.getAllInfos();return await async function(e,t){let r=t.filter(function(e){return-1==i.indexOf(e.qType)}),n=[];if(r.length>0){for(let t of r){let r=await s(e,t.qId);r.isExtension&&n.push({appName:e.id,objId:r.qObjProps.qInfo.qId,objType:r.qObjProps.qInfo.qType,extName:r.qObjProps.extensionMeta.name,extVersion:r.qObjProps.version,extVisible:r.qObjProps.extensionMeta.visible,extIsBundle:!r.qObjProps.extensionMeta.isThirdParty,extIsLibrary:r.qObjProps.extensionMeta.isLibraryItem,qProps:r.qObjProps})}return n}return[]}(this,e)}};var c={handlePromise:e=>e.then(e=>[e,void 0]).catch(e=>Promise.resolve([void 0,e]))};const{handlePromise:l}=c;async function u(t){let r=e.variableList;r.qShowSession=!1,r.qShowConfig=!1,r.qShowReserved=!1;let[n,a]=await l(t.createSessionObject(r));if(a)throw new Error("unbuild variables: cannot create session object");let[i,s]=await l(n.getLayout());if(s)throw new Error("unbuild variables: cannot get session object layout");let[o,c]=await l(t.destroySessionObject(n.id));if(c)throw new Error("unbuild variables: cannot delete session object");return i.qVariableList.qItems}async function f(e){let[t,r]=await l(e.getScript());if(r)throw new Error("unbuild script: cannot fetch script");return t}async function d(e){let[t,r]=await l(e.getAppProperties());if(r)throw new Error("unbuild app properties: cannot fetch app properties");return t}async function w(e){let[t,r]=await l(e.getConnections());if(r)throw new Error("unbuild connections: cannot fetch app connections");return t}async function m(e){let t={dimensions:[],measures:[],objects:[]},[r,n]=await l(e.getAllInfos());if(n)throw new Error("unbuild app infos: cannot fetch all app infos");return Promise.all(r.map(async function(r){if("dimension"==r.qType){let[n,a]=await l(e.getDimension(r.qId));if(a)throw new Error("unbuild dimension: cannot fetch dimension");let[i,s]=await l(n.getProperties());if(s)throw new Error("unbuild dimension: cannot fetch dimension properties");t.dimensions.push(i)}if("measure"==r.qType){let[n,a]=await l(e.getMeasure(r.qId));if(a)throw new Error("unbuild dimension: cannot fetch measure");let[i,s]=await l(n.getProperties());if(s)throw new Error("unbuild dimension: cannot fetch measure properties");t.measures.push(i)}if("dimension"!=r.qType&&"measure"!=r.qType){let n=await async function(e,t){let[r,n]=await l(t.getObject(e.qId));if(n)return{...e,error:!0};let[a,i]=await l(r.getParent()),[s,o]=await r.getChildInfos();if(o)throw new Error("unbuild entity: cannot fetch entity children");if(i&&s.length>0){let[e,t]=await l(r.getFullPropertyTree());if(t)throw new Error("unbuild entity: cannot fetch entity full property tree");return e}let[c,u]=await l(r.getProperties());if(u)throw new Error("unbuild entity: cannot fetch entity properties");return c}(r,e);n.error||t.objects.push(n),n.error}})).then(()=>t)}var p={mUnbuild:async function(){return await Promise.all([await u(this),await f(this),await d(this),await w(this),await m(this)]).then(e=>({variables:e[0],script:e[1],appProperties:e[2],connections:e[3],dimensions:e[4].dimensions,measures:e[4].measures,objects:e[4].objects}))}};const{handlePromise:q}=c;async function h(e,t){return Promise.all(e.map(async function(e){let[r,n]=await q(t.getMeasure(e.qInfo.qId));if(n){let[r,n]=await q(t.createMeasure(e));if(n)throw new Error(`build measure: cannot create measure "${e.qInfo.qId}": ${n.message}`);return{qId:e.qInfo.qId,status:"Created"}}let[a,i]=await q(r.setProperties(e));if(i)throw new Error(`build measure: cannot update measure "${e.qInfo.qId}": ${i.message}`);return{qId:e.qInfo.qId,status:"Updated"}}))}async function b(e,t){return Promise.all(e.map(async function(e){let[r,n]=await q(t.getDimension(e.qInfo.qId));if(n){let[r,n]=await q(t.createDimension(e));if(n)throw new Error(`build dimension: cannot create dimension "${e.qInfo.qId}": ${n.message}`);return{qId:e.qInfo.qId,status:"Created"}}let[a,i]=await q(r.setProperties(measure));if(i)throw new Error(`build dimension: cannot update dimension "${e.qInfo.qId}": ${i.message}`);return{qId:e.qInfo.qId,status:"Updated"}}))}async function y(e,t){let[r,n]=await q(t.setScript(e));if(n)throw new Error(`build script: cannot set script: ${n.message}`);return{status:"Set"}}async function g(e,t){let[r,n]=await q(t.setAppProperties(e));if(n)throw new Error(`build app properties: cannot set app properties: ${n.message}`);return{status:"Set"}}async function I(e,t){return Promise.all(e.map(async function(e){let[r,n]=await q(t.getVariableByName(e.qName));if(n){let[r,n]=await q(t.createVariableEx(e));if(n)throw new Error(`build variable: cannot create variable "${e.qName}": ${n.message}`);return{qId:e.qName,status:"Created"}}let[a,i]=await q(r.setProperties(e));if(i)throw new Error(`build variable: cannot update variable "${e.qName}": ${i.message}`);return{qId:e.qName,status:"Updated"}}))}async function E(e,t,r){return Promise.all(t.map(async function(t){let n=e.find(e=>e.qName===t.qName);if(!n){let[e,n]=await q(r.createConnection(t));if(n)throw new Error(`build connection: cannot create connection "${t.qName}": ${n.message}`);return{qId:t.qName,status:"Created"}}let[a,i]=await q(r.modifyConnection(n.qId,t,!0));if(i)throw new Error(`build connection: cannot modify connection "${t.qName}": ${i.message}`);return{qId:t.qName,status:"Updated"}}))}async function j(e,t){return Promise.all(e.map(async function(e){let r,n,a=!1;e.qInfo?(r=e.qInfo.qId,n=e.qInfo.qType):(a=!0,r=e.qProperty.qInfo.qId,n=e.qProperty.qInfo.qType);let[i,s]=await q(t.getObject(r));if(!s){if(a){let[t,n]=await q(i.setFullPropertyTree(e));if(n)throw new Error(`build object: cannot update object "${r}": ${n.message}`);return{qId:r,status:"Updated"}}if(!a){let[t,n]=await q(i.setProperties(e));if(n)throw new Error(`build object: cannot update object "${r}": ${n.message}`);return{qId:r,status:"Updated"}}}if(s){if(a){let[a,i]=await q(t.createObject({qInfo:{qId:`${r}`,qType:n}}));if(i)throw new Error(`build object: cannot create object "${r}": ${i.message}`);let[s,o]=await q(a.setFullPropertyTree(e));if(o)throw new Error(`build object: cannot update object "${r}": ${o.message}`);return{qId:r,status:"Created"}}if(!a){let[n,a]=await q(t.createObject(e));if(a)throw new Error(`build object: cannot create object: "${r}": ${a.message}`);return{qId:r,status:"Created"}}}}))}return[{types:["Doc"],init(e){},extend:{...n,...a,...t,...o,...p,...{mBuild:async function({variables:e=[],script:t=!1,appProperties:r={},connections:n=[],measures:a=[],dimensions:i=[],objects:s=[]}){let[o,c]=await q(this.getConnections());if(c)throw new Error("build: cannot get app connections");return Promise.all([await h(a,this),await b(i,this),await I(e,this),await y(t,this),await g(r,this),await E(o,n,this),await j(s,this)]).then(function(e){return{measures:e[0],dimensions:e[1],variables:e[2],script:e[3],appProperties:e[4],connections:e[5],objects:e[6]}})}}}}]});
//# sourceMappingURL=enigma-mixin.min.js.map
