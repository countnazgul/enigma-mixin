!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self)["enigma-mixin"]=t()}(this,function(){"use strict";var e={sessionList:{qInfo:{qId:"",qType:"SessionLists"},qSelectionObjectDef:{}},variableList:{qInfo:{qType:"VariableList"},qVariableListDef:{qType:"variable"}},listBox:{qInfo:{qId:"",qType:""},field:{qListObjectDef:{qStateName:"$",qDef:{qFieldDefs:[],qSortCriterias:[{qSortByState:1,qExpression:{}}]},qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:1e4,qWidth:1}]}}}};var t={handlePromise:e=>e.then(e=>[e,void 0]).catch(e=>Promise.resolve([void 0,e]))};const{handlePromise:r}=t;var i={mVariableGetAll:async function(t=!1,i=!1,n=!1){let a=e.variableList;a.qShowSession=t,a.qShowConfig=i,a.qShowReserved=n;let[s,o]=await r(this.createSessionObject(a));if(o)throw new Error(o.message);let[c,l]=await r(s.getLayout());if(l)throw new Error(l.message);return c.qVariableList.qItems},mVariableUpdateById:async function(e,t,i){let[n,a]=await r(this.getVariableById(e));if(a)throw new Error(a.message);let[s,o]=await r(n.getProperties());if(o)throw new Error(o.message);s.qDefinition=t,i&&(s.qComment=i);let[c,l]=await r(n.setProperties(s));if(l)throw new Error(l.message);let[u,f]=await r(n.getProperties());if(f)throw new Error(f.message);return u},mVariableUpdateByName:async function(e,t,i){let[n,a]=await r(this.getVariableByName(e));if(a)throw new Error(a.message);let[s,o]=await r(n.getProperties());if(o)throw new Error(o.message);s.qDefinition=t,i&&(s.qComment=i);let[c,l]=await r(n.setProperties(s));if(l)throw new Error(l.message);let[u,f]=await r(n.getProperties());if(f)throw new Error(f.message);return u},mVariableCreate:async function(e="",t="",i=""){let n={qInfo:{qType:"variable"},qName:e,qDefinition:t,qComment:i},[a,s]=await r(this.createVariableEx(n));if(s)throw new Error(s.message);let[o,c]=await r(a.getProperties());if(c)throw new Error(c.message);return o}};const{handlePromise:n}=t;async function a(t){let[r,i]=await n(t.createSessionObject(e.sessionList));if(i)throw new Error(i.message);let[a,s]=await n(r.getLayout());if(s)throw new Error(s.message);let[o,c]=await n(t.destroySessionObject(r.id));if(c)throw new Error(c.message);return a}var s={mSelectionsAll:async function(){let[e,t]=await n(a(this));if(t)throw new Error(t.message);return e.qSelectionObject},mSelectionsFields:async function(){let[e,t]=await n(a(this));if(t)throw new Error(t.message);return e.qSelectionObject.qSelections.map(function(e){return e.qField})},mSelectionsSimple:async function(e=!1){let[t,r]=await n(a(this));if(r)throw new Error(r.message);return e?t.qSelectionObject.qSelections.map(function(e){let t=e.qSelectedFieldSelectionInfo.map(function(e){return e.qName});return{field:e.qField,values:t}}):t.qSelectionObject.qSelections.map(function(e){return e.qSelectedFieldSelectionInfo.map(function(t){return{field:e.qField,value:t.qName}})}).flat()},mSelectInField:async function(t,r,i=!1){let a=e.listBox;a.field.qListObjectDef.qDef.qFieldDefs=[t],a.qInfo.qType="session-listbox";let[s,o]=await n(this.createSessionObject(a));if(o)throw new Error(o.message);let[c,l]=await n(s.getLayout());if(l)throw new Error(l.message);let u=c.field.qListObject.qDataPages[0].qMatrix.filter(function(e){return r.indexOf(e[0].qText)>-1}).map(function(e){return e[0].qElemNumber}),[f,w]=await n(s.selectListObjectValues("/field/qListObjectDef",u,i));if(w)throw new Error(w.message);let[d,m]=await n(this.destroySessionObject(s.id));if(m)throw new Error(m.message);return f}};const{handlePromise:o}=t;var c={mGetTablesAndFields:async function(){let[e,t]=await o(this.getTablesAndKeys({},{},0,!0,!1));if(t)throw new Error(t.message);return e.qtr.map(function(e){return e.qFields.map(function(t){return{table:e.qName,field:t.qName}})}).flat()},mGetTables:async function(){let[e,t]=await o(this.getTablesAndKeys({},{},0,!0,!1));if(t)throw new Error(t.message);return e.qtr.map(e=>e.qName)},mGetFields:async function(){let[e,t]=await o(this.getTablesAndKeys({},{},0,!0,!1));if(t)throw new Error(t.message);return e.qtr.map(function(e){return e.qFields.map(function(e){return e.qName})}).flat()},mCreateSessionListbox:async function(t,r="session-listbox"){let i=e.listBox;i.field.qListObjectDef.qDef.qFieldDefs=[t],i.qInfo.qType=r;let[n,a]=await o(this.createSessionObject(i));if(a)throw new Error(a.message);let[s,c]=await o(n.getLayout());if(c)throw new Error(c.message);return{sessionObj:n,layout:s}}};const{handlePromise:l}=t;const u=async function(e,t){let[r,i]=await l(e.getObject(t));if(i)return{isExtension:!1};let[n,a]=await l(r.getProperties());if(a)throw new Error(a.message);return n.visualization?{qObjProps:n,isExtension:!(-1!=["barchart","boxplot","combochart","distributionplot","gauge","histogram","kpi","linechart","piechart","pivot-table","scatterplot","table","treemap","extension","map","listbox","filterpane","title","paragraph"].indexOf(n.visualization)||!n.extensionMeta)}:{isExtension:!1}};var f={mExtensionObjectsAll:async function(){let[e,t]=await l(this.getAllInfos());if(t)throw new Error(t.message);return await async function(e,t){return await Promise.all(t.map(async function(t){let r=await u(e,t.qId);if(r.isExtension)return{appName:e.id,objId:r.qObjProps.qInfo.qId,objType:r.qObjProps.qInfo.qType,extName:r.qObjProps.extensionMeta.name,extVersion:r.qObjProps.version,extVisible:r.qObjProps.extensionMeta.visible,extIsBundle:!r.qObjProps.extensionMeta.isThirdParty,extIsLibrary:r.qObjProps.extensionMeta.isLibraryItem,qProps:r.qObjProps}})).then(function(e){return e.filter(function(e){return null!=e})})}(this,e)}};const{handlePromise:w}=t;async function d(t){let r=e.variableList;r.qShowSession=!1,r.qShowConfig=!1,r.qShowReserved=!1;let[i,n]=await w(t.createSessionObject(r));if(n)throw new Error("unbuild variables: cannot create session object");let[a,s]=await w(i.getLayout());if(s)throw new Error("unbuild variables: cannot get session object layout");let[o,c]=await w(t.destroySessionObject(i.id));if(c)throw new Error("unbuild variables: cannot delete session object");return a.qVariableList.qItems}async function m(e){let[t,r]=await w(e.getScript());if(r)throw new Error("unbuild script: cannot fetch script");return t}async function q(e){let[t,r]=await w(e.getAppProperties());if(r)throw new Error("unbuild app properties: cannot fetch app properties");return t}async function p(e){let[t,r]=await w(e.getConnections());if(r)throw new Error("unbuild connections: cannot fetch app connections");return t}async function b(e){let t={dimensions:[],measures:[],objects:[]},[r,i]=await w(e.getAllInfos());if(i)throw new Error("unbuild app infos: cannot fetch all app infos");return Promise.all(r.map(async function(r){if("dimension"==r.qType){let[i,n]=await w(e.getDimension(r.qId));if(n)throw new Error("unbuild dimension: cannot fetch dimension");let[a,s]=await w(i.getProperties());if(s)throw new Error("unbuild dimension: cannot fetch dimension properties");t.dimensions.push(a)}if("measure"==r.qType){let[i,n]=await w(e.getMeasure(r.qId));if(n)throw new Error("unbuild dimension: cannot fetch measure");let[a,s]=await w(i.getProperties());if(s)throw new Error("unbuild dimension: cannot fetch measure properties");t.measures.push(a)}if("dimension"!=r.qType&&"measure"!=r.qType){let i=await async function(e,t){let[r,i]=await w(t.getObject(e.qId));if(i)return{...e,error:!0};let[n,a]=await w(r.getParent()),[s,o]=await w(r.getChildInfos());if(o)throw new Error("unbuild entity: cannot fetch entity children");if(a&&s.length>0){let[e,t]=await w(r.getFullPropertyTree());if(t)throw new Error("unbuild entity: cannot fetch entity full property tree");return e}let[c,l]=await w(r.getProperties());if(l)throw new Error("unbuild entity: cannot fetch entity properties");return c}(r,e);i.error||t.objects.push(i),i.error}})).then(()=>t)}var h={mUnbuild:async function(){return await Promise.all([await d(this),await m(this),await q(this),await p(this),await b(this)]).then(e=>({variables:e[0],script:e[1],appProperties:e[2],connections:e[3],dimensions:e[4].dimensions,measures:e[4].measures,objects:e[4].objects}))}};const{handlePromise:y}=t;async function g(e,t){return Promise.all(e.map(async function(e){let[r,i]=await y(t.getMeasure(e.qInfo.qId));if(i){let[r,i]=await y(t.createMeasure(e));if(i)throw new Error(`build measure: cannot create measure "${e.qInfo.qId}": ${i.message}`);return{qId:e.qInfo.qId,status:"Created"}}let[n,a]=await y(r.setProperties(e));if(a)throw new Error(`build measure: cannot update measure "${e.qInfo.qId}": ${a.message}`);return{qId:e.qInfo.qId,status:"Updated"}}))}async function I(e,t){return Promise.all(e.map(async function(e){let[r,i]=await y(t.getDimension(e.qInfo.qId));if(i){let[r,i]=await y(t.createDimension(e));if(i)throw new Error(`build dimension: cannot create dimension "${e.qInfo.qId}": ${i.message}`);return{qId:e.qInfo.qId,status:"Created"}}let[n,a]=await y(r.setProperties(measure));if(a)throw new Error(`build dimension: cannot update dimension "${e.qInfo.qId}": ${a.message}`);return{qId:e.qInfo.qId,status:"Updated"}}))}async function E(e,t){let[r,i]=await y(t.setScript(e));if(i)throw new Error(`build script: cannot set script: ${i.message}`);return{status:"Set"}}async function j(e,t){let[r,i]=await y(t.setAppProperties(e));if(i)throw new Error(`build app properties: cannot set app properties: ${i.message}`);return{status:"Set"}}async function P(e,t){return Promise.all(e.map(async function(e){let[r,i]=await y(t.getVariableByName(e.qName));if(i){let[r,i]=await y(t.createVariableEx(e));if(i)throw new Error(`build variable: cannot create variable "${e.qName}": ${i.message}`);return{qId:e.qName,status:"Created"}}let[n,a]=await y(r.setProperties(e));if(a)throw new Error(`build variable: cannot update variable "${e.qName}": ${a.message}`);return{qId:e.qName,status:"Updated"}}))}async function S(e,t,r){return Promise.all(t.map(async function(t){let i=e.find(e=>e.qName===t.qName);if(!i){let[e,i]=await y(r.createConnection(t));if(i)throw new Error(`build connection: cannot create connection "${t.qName}": ${i.message}`);return{qId:t.qName,status:"Created"}}let[n,a]=await y(r.modifyConnection(i.qId,t,!0));if(a)throw new Error(`build connection: cannot modify connection "${t.qName}": ${a.message}`);return{qId:t.qName,status:"Updated"}}))}async function O(e,t){return Promise.all(e.map(async function(e){let r,i,n=!1;e.qInfo?(r=e.qInfo.qId,i=e.qInfo.qType):(n=!0,r=e.qProperty.qInfo.qId,i=e.qProperty.qInfo.qType);let[a,s]=await y(t.getObject(r));if(!s){if(n){let[t,i]=await y(a.setFullPropertyTree(e));if(i)throw new Error(`build object: cannot update object "${r}": ${i.message}`);return{qId:r,status:"Updated"}}if(!n){let[t,i]=await y(a.setProperties(e));if(i)throw new Error(`build object: cannot update object "${r}": ${i.message}`);return{qId:r,status:"Updated"}}}if(s){if(n){let[n,a]=await y(t.createObject({qInfo:{qId:`${r}`,qType:i}}));if(a)throw new Error(`build object: cannot create object "${r}": ${a.message}`);let[s,o]=await y(n.setFullPropertyTree(e));if(o)throw new Error(`build object: cannot update object "${r}": ${o.message}`);return{qId:r,status:"Created"}}if(!n){let[i,n]=await y(t.createObject(e));if(n)throw new Error(`build object: cannot create object: "${r}": ${n.message}`);return{qId:r,status:"Created"}}}}))}return[{types:["Doc"],init(e){},extend:{...s,...c,...i,...f,...h,...{mBuild:async function({variables:e=[],script:t=!1,appProperties:r={},connections:i=[],measures:n=[],dimensions:a=[],objects:s=[]}){let[o,c]=await y(this.getConnections());if(c)throw new Error("build: cannot get app connections");return Promise.all([await g(n,this),await I(a,this),await P(e,this),await E(t,this),await j(r,this),await S(o,i,this),await O(s,this)]).then(function(e){return{measures:e[0],dimensions:e[1],variables:e[2],script:e[3],appProperties:e[4],connections:e[5],objects:e[6]}})}}}}]});
//# sourceMappingURL=enigma-mixin.min.js.map
